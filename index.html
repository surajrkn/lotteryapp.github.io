<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
</head>
<body>
    <div class="container">
        <h1>Kerala Lottery Winning Number Search App</h1>
        <form action="" method="POST" id="addForm">
            Date : 
            <input type="text" id="date">
            Day :
            <input type="text" id="day">
            
            Number :
            <input type="text" id="number">
            <input type="submit" id="add" value="Add">
            <span class="success hidden">Added successfully</span>
            <hr/>
        </form>
        
        <form action="" method="POST" id="searchForm">
            Search Number :
            <input type="text" id="searchBar">
            <input type="submit" id="search" value="search">
        </form>
    
        <div id="showData"></div>
        <H2>Search Result</H2></hr>
        <div id="searchResultShow"></div>
    </div>

   <style>
       .container {
           display: flex;
           margin: auto;
           flex-direction: column;
           justify-content: center;
           align-items: center;
       }
       form {
           width: 100%;
       }
       input {
           padding: 5px;
       }
       input[type='submit'] {
           background: green;
           border: 0;
           color: #fff;
           padding: 7px 20px;
           cursor: pointer;
       }
       .success {
           color: green;
           font-weight: bold;
       }
       .hidden {
           display: none;
       }
   </style> 

    <!-- The core Firebase JS SDK is always required and must be listed first -->
<script src="https://www.gstatic.com/firebasejs/7.6.1/firebase-app.js"></script>


<!-- TODO: Add SDKs for Firebase products that you want to use
     https://firebase.google.com/docs/web/setup#available-libraries -->
<script src="https://www.gstatic.com/firebasejs/7.6.1/firebase-analytics.js"></script>

<script src="https://www.gstatic.com/firebasejs/7.6.1/firebase-database.js"></script>


<script>
  // Your web app's Firebase configuration
  var firebaseConfig = {
    apiKey: "AIzaSyDbuXv96MCMQ2CvQjm-HDyCu5NypGs926g",
    authDomain: "lotteryregistry.firebaseapp.com",
    databaseURL: "https://lotteryregistry.firebaseio.com",
    projectId: "lotteryregistry",
    storageBucket: "lotteryregistry.appspot.com",
    messagingSenderId: "1022608917134",
    appId: "1:1022608917134:web:7c6f652160277337197fdf",
    measurementId: "G-N0F7M5RJ5P"
  };
  // Initialize Firebase
  firebase.initializeApp(firebaseConfig);
  firebase.analytics();

    // Get a reference to the database service
    var database = firebase.database();

    

    

        const button = document.getElementById('add');
        const form = document.getElementById('addForm');
        var date = document.getElementById('date'),
            day = document.getElementById('day'),
            number = document.getElementById('number'),
            search = document.getElementById('search'),
            searchBar = document.getElementById('searchBar'),
            searchResultShow = document.getElementById('searchResultShow'),
            success = document.querySelector('.success');
        var id = 2;
        var showData = document.getElementById('showData');
        button.addEventListener('click', function(e){
            e.preventDefault();
            var isAllFieldHasValue = validate(date.value,day.value,number.value);
            if(isAllFieldHasValue == true) {
                writeRegistyData(id,date.value,day.value,number.value);
            } else {
                alert('please fill all the fields');
            }
            
            //console.log(data);

        })

        function writeRegistyData(id, date, day, number) {

        firebase.database().ref('registry/' + id).set({
            date: date,
            day: day,
            number : number
        },function(err){
            if(err){
                console.log('failed')
            } else {
                success.classList.remove('hidden');
                console.log('data added success!')

                setTimeout(() => {
                    success.classList.add('hidden');
                },1000);
            }
        });
        }

        
        
        database.ref('registry').on('value', function(snapshot){

        // local data
        var data = snapshot.val();
        console.log('data',data);
        showData.innerHTML = '';
        data.map((val,index) => {
            console.log('map', val,index)
            //showData.innerHTML += val.number + '</br>';
        });
        var reducedData = data.reduce((prevIndex,currentIndex,index) => {
            id = index+1;
            console.log('index',index)
        });
       

        console.log('filtered data', id);
        search.addEventListener('click', function(e){
            e.preventDefault();
            var searchResult = searchNumber(searchBar.value, data);
            console.log('search', searchResult[0].date);
            searchResultShow.innerHTML = '';
            searchResult.map((data) => {
                searchResultShow.innerHTML += data.date + ' '+ data.day+ ' '+data.number+'</br>';
            })
            
        })
        
    });
    
    
    function searchNumber(term,datas){
        
        var filter = datas.filter((data) => {
            console.log('suraj',data);
            return data.number.indexOf(term) > -1;
        });
        return filter;
        
    }

    function validate(date,day,number){
        var isValid = false;
        if(date == '' || day == '' || number == '') {
            isValid = false;
        } else {
            isValid = true;
        }
        return isValid;
    }

        //
</script>
</body>
</html>